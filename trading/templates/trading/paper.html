{% extends "base.html" %}
{% load static i18n %}

{% block title %}{% bilingual "Paper Trading" "模拟实盘" %}{% endblock %}

{% block content %}
<div class="container-xl paper-page">
    <div class="paper-env-bar" data-role="env-bar">
        <div class="paper-env-left">
            <span class="paper-env-pill" data-role="env-mode-pill">PAPER</span>
            <span class="paper-env-status" data-role="env-connection">
                {% bilingual "Connecting…" "连接中…" %}
            </span>
            <span class="paper-env-updated" data-role="env-updated"></span>
            <span class="paper-env-freshness" data-role="env-freshness"></span>
        </div>
        <div class="paper-env-right">
            <div class="paper-env-toggle" role="group" aria-label="{% bilingual 'Trading mode' '交易模式' %}">
                <button type="button" class="paper-env-btn" data-role="alpaca-mode-btn" data-mode="paper">
                    {% bilingual "PAPER" "模拟" %}
                </button>
                <button type="button" class="paper-env-btn" data-role="alpaca-mode-btn" data-mode="live">
                    {% bilingual "LIVE" "实盘" %}
                </button>
            </div>
            <div class="paper-env-refresh">
                <button type="button" class="btn btn-outline-secondary btn-sm" data-role="alpaca-refresh">
                    {% bilingual "Refresh" "刷新" %}
                </button>
            </div>
            <div class="paper-env-auto">
                <span class="paper-env-label">{% bilingual "Auto" "自动" %}</span>
                <div class="paper-env-auto-group" data-role="alpaca-auto-toggle">
                    <button type="button" class="paper-env-auto-btn" data-interval="0">Off</button>
                    <button type="button" class="paper-env-auto-btn" data-interval="15000">15s</button>
                    <button type="button" class="paper-env-auto-btn" data-interval="30000">30s</button>
                    <button type="button" class="paper-env-auto-btn" data-interval="60000">60s</button>
                </div>
            </div>
        </div>
    </div>
    <div class="paper-hero-shell mb-4">
    <header class="paper-hero glass-panel">
        <div class="paper-hero__left">
            <p class="paper-hero__kicker">{% bilingual "Alpaca live & paper accounts" "连接 Alpaca 实盘与模拟盘" %}</p>
            <h1 class="paper-hero__title">{% bilingual "Paper Trading" "模拟实盘" %}</h1>
            <p class="paper-hero__desc">
                {% bilingual "Manage Alpaca account equity, positions, and manual rebalancing in one place." "在此查看 Alpaca 账户权益、持仓并进行手动调仓。" %}
            </p>
            <div class="paper-hero__chips">
                <span class="chip chip-light">{% bilingual "Source: Alpaca" "数据来源：Alpaca" %}</span>
                <span class="chip chip-light">{% bilingual "Mode: Paper / Live" "模式：模拟 / 实盘" %}</span>
            </div>
        </div>
    </header>
    </div>

    <div class="row g-4 mt-2">
        <div class="col-lg-4">
            <div class="card shadow-sm paper-card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h2 class="h5 mb-0">{% bilingual "Account summary" "账户概览" %}</h2>
                        <span class="paper-status-pill" data-role="alpaca-status-pill">—</span>
                    </div>
                    <div class="paper-alpaca-summary" data-role="alpaca-summary">
                        <p class="text-muted small mb-0">{% bilingual "Loading account..." "正在加载账户..." %}</p>
                    </div>
                    <div class="paper-summary-meta">
                        <span class="text-muted small" data-role="alpaca-updated"></span>
                        <span class="text-muted small" data-role="alpaca-error"></span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-8">
            <div class="card shadow-sm paper-card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2 flex-wrap gap-2">
                        <div>
                            <h2 class="h5 mb-1">{% bilingual "Positions & rebalance" "持仓与调仓" %}</h2>
                            <p class="text-muted small mb-0">{% bilingual "Adjust target weights and execute manual rebalance." "填写目标权重并执行手动调仓。" %}</p>
                        </div>
                        <div class="d-flex flex-wrap gap-2">
                            <button type="button" class="btn btn-outline-secondary btn-sm" data-role="alpaca-reset">
                                {% bilingual "Reset targets" "重置目标" %}
                            </button>
                            <button type="button" class="btn btn-outline-danger btn-sm" data-role="alpaca-liquidate">
                                {% bilingual "Liquidate" "清仓" %}
                            </button>
                            <button type="button" class="btn btn-primary btn-sm" data-role="alpaca-preview">
                                {% bilingual "Preview rebalance" "预览调仓" %}
                            </button>
                        </div>
                    </div>
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="alpaca-liquidate-unlisted" data-role="alpaca-liquidate-unlisted">
                        <label class="form-check-label" for="alpaca-liquidate-unlisted">
                            {% bilingual "Sell positions not listed in targets" "未填目标的持仓也卖出" %}
                        </label>
                    </div>
                    <div class="paper-alpaca-positions" data-role="alpaca-positions">
                        <p class="text-muted small mb-0">{% bilingual "Loading positions..." "正在加载持仓..." %}</p>
                    </div>
                    <div class="paper-rebalance-footer">
                        <div class="paper-rebalance-summary" data-role="alpaca-rebalance-summary"></div>
                        <button type="button" class="btn btn-outline-secondary btn-sm" data-role="alpaca-normalize">
                            {% bilingual "Normalize weights" "归一化权重" %}
                        </button>
                    </div>
                    <div class="text-muted small mt-2" data-role="alpaca-rebalance-status"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="paper-modal" data-role="paper-modal" hidden>
        <div class="paper-modal__overlay" data-role="paper-modal-close"></div>
        <div class="paper-modal__content" role="dialog" aria-modal="true" aria-labelledby="paper-modal-title">
            <header class="paper-modal__header">
                <h3 id="paper-modal-title" class="paper-modal__title" data-role="paper-modal-title"></h3>
                <button type="button" class="paper-modal__close" data-role="paper-modal-close">×</button>
            </header>
            <div class="paper-modal__body">
                <div data-role="paper-modal-body"></div>
                <div class="paper-modal__input" data-role="paper-modal-input" hidden>
                    <label for="paper-modal-confirm" class="form-label">{% bilingual "Type LIVE to confirm" "输入 LIVE 以确认" %}</label>
                    <input id="paper-modal-confirm" class="form-control" type="text" placeholder="LIVE">
                </div>
            </div>
            <footer class="paper-modal__footer">
                <button type="button" class="btn btn-outline-secondary" data-role="paper-modal-cancel">
                    {% bilingual "Cancel" "取消" %}
                </button>
                <button type="button" class="btn btn-primary" data-role="paper-modal-confirm">
                    {% bilingual "Confirm" "确认" %}
                </button>
            </footer>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{% static 'trading/js/paper_trading.js' %}?v={{ STATIC_VERSION|default:'1' }}" nonce="{{ csp_nonce }}" defer></script>
{% endblock %}
